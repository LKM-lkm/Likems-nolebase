项目结构
nolebase
Public
nolebase/nolebase
Go to file
t
Name		
renovate[bot]
renovate[bot]
chore(deps): update all non-major dependencies (#185)
f4d1e05
 · 
3 weeks ago
.github
chore(deps): update dawidd6/action-download-artifact action to v11 (#181
2 months ago
.obsidian
fix: search bar
6 months ago
.vitepress
style: fix for hero title
6 months ago
.vscode
chore: bump dependencies
10 months ago
metadata
refactor: improve: move contributors config in creator.tsto `metada…
last year
netlify/functions
chore: 更新依赖，聚合域名和仓库地址的配置
last year
public
fix: 404 on start page
7 months ago
scripts
feat: integrated sidebar plugin
10 months ago
zh-CN
fix: bidirectional link issue
last month
.editorconfig
chore: 修复 markdown lint
2 years ago
.eslintignore
chore: 修复 markdown lint
2 years ago
.gitattributes
chore: 调整 linguist 配置
2 years ago
.gitignore
docs: update deps
last year
LICENSE
docs: 添加代码授权协议和文档授权协议
3 years ago
LICENSE-CC-BY-SA
docs: switch to CC BY-SA license (#22)
2 years ago
README.md
docs: display sponsors
10 months ago
README_EN.md
docs: added English version of README.md (#78)
9 months ago
eslint.config.js
chore: 修复损坏的 eslint，适配新的 Nolebase 集成 API
last year
netlify.toml
feat: Netlify 迁移到 GitHub Actions (#5)
2 years ago
package.json
chore(deps): update all non-major dependencies (#185)
3 weeks ago
pnpm-lock.yaml
chore(deps): update all non-major dependencies (#185)
3 weeks ago
tsconfig.json
chore: 修复损坏的 eslint，适配新的 Nolebase 集成 API
last year
uno.config.ts
fix: lint and tag fix
2 years ago
vite.config.ts
feat: switch to use @nolebase/integrations directly (#160)
6 months ago

`config.ts`
```
import { presetMarkdownIt } from '@nolebase/integrations/vitepress/markdown-it'
import { transformHeadMeta } from '@nolebase/vitepress-plugin-meta'
import { calculateSidebar } from '@nolebase/vitepress-plugin-sidebar'
// import { buildEndGenerateOpenGraphImages } from '@nolebase/vitepress-plugin-og-image/vitepress'
import MarkdownItFootnote from 'markdown-it-footnote'
import MarkdownItMathjax3 from 'markdown-it-mathjax3'
import { defineConfig } from 'vitepress'

import { discordLink, githubRepoLink, siteDescription, siteName } from '../metadata'
import head from './head'

const nolebase = presetMarkdownIt()

export default defineConfig({
  vue: {
    template: {
      transformAssetUrls: {
        video: ['src', 'poster'],
        source: ['src'],
        img: ['src'],
        image: ['xlink:href', 'href'],
        use: ['xlink:href', 'href'],
        NolebaseUnlazyImg: ['src'],
      },
    },
  },
  title: siteName,
  description: siteDescription,
  ignoreDeadLinks: true,
  head,
  themeConfig: {
    search: {
      provider: 'local',
      options: {
        locales: {
          root: {
            translations: {
              button: {
                buttonText: '搜索文档',
                buttonAriaLabel: '搜索文档',
              },
              modal: {
                noResultsText: '无法找到相关结果',
                resetButtonTitle: '清除查询条件',
                footer: {
                  selectText: '选择',
                  navigateText: '切换',
                },
              },
            },
          },
        },

        // Add title ang tags field in frontmatter to search
        // You can exclude a page from search by adding search: false to the page's frontmatter.
        _render(src, env, md) {
          // without `md.render(src, env)`, the some information will be missing from the env.
          let html = md.render(src, env)
          let tagsPart = ''
          let headingPart = ''
          let contentPart = ''
          let fullContent = ''
          const sortContent = () => [headingPart, tagsPart, contentPart] as const
          let { frontmatter, content } = env

          if (!frontmatter)
            return html

          if (frontmatter.search === false)
            return ''

          contentPart = content ||= src

          const headingMatch = content.match(/^# .*/m)
          const hasHeading = !!(headingMatch && headingMatch[0] && headingMatch.index !== undefined)

          if (hasHeading) {
            const headingEnd = headingMatch.index! + headingMatch[0].length
            headingPart = content.slice(0, headingEnd)
            contentPart = content.slice(headingEnd)
          }
          else if (frontmatter.title) {
            headingPart = `# ${frontmatter.title}`
          }

          const tags = frontmatter.tags
          if (tags && Array.isArray(tags) && tags.length)
            tagsPart = `Tags: #${tags.join(', #')}`

          fullContent = sortContent().filter(Boolean).join('\n\n')

          html = md.render(fullContent, env)

          return html
        },
      },
    },
  },
  locales: {
    root: {
      lang: 'zh-CN',
      label: '中文',
      dir: '/zh-CN',
      link: '/zh-CN',
      themeConfig: {
        nav: [
          { text: '主页', link: '/zh-CN/' },
          { text: '笔记', link: '/zh-CN/笔记/' },
          { text: '编目 Catalog', link: '/zh-CN/编目 Catalog/' },
          { text: '最近更新', link: '/zh-CN/toc' },
        ],
        socialLinks: [
          { icon: 'github', link: githubRepoLink },
          { icon: 'discord', link: discordLink },
        ],
        darkModeSwitchLabel: '切换主题',
        outline: { label: '页面大纲', level: 'deep' },
        editLink: {
          pattern: `${githubRepoLink}/tree/main/:path`,
          text: '编辑本页面',
        },
        sidebar: calculateSidebar([
          { folderName: 'zh-CN/笔记', separate: true },
          { folderName: 'zh-CN/编目 Catalog', separate: true },
        ], 'zh-CN'),
        footer: {
          message: '用 <span style="color: #e25555;">&#9829;</span> 撰写',
          copyright:
        '<a class="footer-cc-link" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> © 2022-PRESENT Nólëbase 的创作者们',
        },
      },
    },
  },
  markdown: {
    theme: {
      light: 'github-light',
      dark: 'one-dark-pro',
    },
    math: true,
    preConfig: async (md) => {
      await nolebase.install(md)
    },
    config: (md) => {
      md.use(MarkdownItFootnote)
      md.use(MarkdownItMathjax3)
    },
  },
  async transformHead(context) {
    let head = [...context.head]

    const returnedHead = await transformHeadMeta()(head, context)
    if (typeof returnedHead !== 'undefined')
      head = returnedHead

    return head
  },
  // async buildEnd(siteConfig) {
  //   await buildEndGenerateOpenGraphImages({
  //     baseUrl: targetDomain,
  //     category: {
  //       byLevel: 2,
  //     },
  //   })(siteConfig)
  // },
})
```

`index.ts`
```
import type { Theme } from 'vitepress'

import { presetClient } from '@nolebase/integrations/vitepress/client'
import DefaultTheme from 'vitepress/theme'
import { h } from 'vue'

import AppContainer from './components/AppContainer.vue'
import DocFooter from './components/DocFooter.vue'
import HomePage from './components/HomePage.vue'
import Share from './components/Share.vue'

import 'virtual:uno.css'
import '../styles/main.css'
import '../styles/vars.css'

const nolebase = presetClient<{
  tags: string[]
  progress: number
}>({
  enhancedReadabilities: {
    options: {
      layoutSwitch: {
        defaultMode: 4,
      },
      spotlight: {
        defaultToggle: true,
        hoverBlockColor: 'rgb(240 197 52 / 7%)',
      },
    },
  },
})

const ExtendedTheme: Theme = {
  extends: DefaultTheme,
  Layout: () => {
    const slots = nolebase!.enhanceLayout?.() ?? {}

    return h(DefaultTheme.Layout, null, {
      // https://vitepress.dev/guide/extending-default-theme#layout-slots
      'doc-top': () => [
        ...slots['doc-top'].map(slot => slot()),
      ],
      'doc-footer-before': () => [
        h(DocFooter),
      ],
      'nav-bar-content-after': () => [
        h(Share),
        ...slots['nav-bar-content-after'].map(slot => slot()),
      ],
      'nav-screen-content-after': () => [
        ...slots['nav-screen-content-after'].map(slot => slot()),
      ],
    })
  },
  async enhanceApp(ctx) {
    const { app } = ctx

    /**
     * Have to manually import and register the essential components that needed during build globally.
     *
     * Learn more at: Warn `Hydration completed but contains mismatches.` and Custom components are not rendered · Issue #1918 · vuejs/vitepress
     * https://github.com/vuejs/vitepress/issues/1918
     */

    await nolebase?.enhanceApp?.(ctx)

    app.component('HomePage', HomePage)
    app.component('DocFooter', DocFooter)
    app.component('Share', Share)
    app.component('AppContainer', AppContainer)
  },
}

export default ExtendedTheme
```

`HomePage.vue`
```
<script setup lang="ts">
import { VPTeamMembers } from 'vitepress/theme'
import { creators, siteName } from '../../../metadata'
</script>

<template>
  <div class="content">
    <div class="content-container">
      <main class="main">
        <div class="vp-doc" mt-10 flex flex-col items-center>
          <h2 id="meet-the-team" font-normal op50 p="t-10 b-2">
            {{ siteName }} 的创作者
          </h2>
          <div w-full p-10>
            <VPTeamMembers size="small" :members="creators" flex justify-center />
          </div>

          <div>
            <h2 mt-11 pb-2 text-center>
              Sponsors
            </h2>
            <div flex justify-center>
              <img src="https://cdn.jsdelivr.net/gh/nolebase/sponsors/sponsors.wide.svg">
            </div>

            <p text-center>
              这个项目得以实现，要感谢所有支持我们的 Sponsors<br>
              你也可以访问我们的 Sponsors 页面来加入其中：
            </p>
            <p flex justify-center gap-4>
              <a href="https://github.com/sponsors/LittleSound" target="_blank"><img src="https://img.shields.io/static/v1?label=Sponsor&message=Rizumu&logo=GitHub&color=%23fe8e86&style=for-the-badge"></a>
              <a href="https://github.com/sponsors/nekomeowww" target="_blank"><img src="https://img.shields.io/static/v1?label=Sponsor&message=Neko&logo=GitHub&color=%23fe8e86&style=for-the-badge"></a>
            </p>

            <h2 text="center lg" my-5 font-bold>
              💕 感谢所有贡献者！
            </h2>

            <a href="https://github.com/nolebase/nolebase/graphs/contributors">
              <img src="https://contrib.rocks/image?repo=nolebase/nolebase">
            </a>
          </div>
        </div>
      </main>
    </div>
  </div>
</template>
```
